<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hackathon AI Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- pdf.js for PDFs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
  <!-- Mammoth.js for DOCX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <style>
    :root {
      --section-bg: rgba(255, 255, 255, 0.90);
      --section-bg-hover: rgba(239, 246, 255, 0.99);
    }
    body { font-family: 'Inter', sans-serif; }
    .backdrop-glass {
      background: rgba(255, 255, 255, 0.72);
      box-shadow: 0 6px 60px -8px rgba(49, 75, 182, 0.08);
      backdrop-filter: blur(20px);
    }
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(28px) }
      to   { opacity: 1; transform: none }
    }
    .animate-fade-in { animation: fade-in 0.7s cubic-bezier(.4,0,.2,1) both; }
    @keyframes slide-up {
      from { opacity: 0; transform: translateY(40px) }
      to   { opacity: 1; transform: none }
    }
    .animate-slide-up { animation: slide-up 0.8s cubic-bezier(.4,0,.2,1) both; }
    .delay-200 { animation-delay: 0.2s }
    .delay-300 { animation-delay: 0.3s }
    .section-box {
      background: var(--section-bg);
      border-radius: 1.25rem;
      box-shadow: 0 4px 24px rgba(56, 102, 255, 0.07), 0 1.5px 8px 0 rgba(30, 64, 175, 0.05);
      padding: 1.8rem;
      margin-bottom: 0.75rem;
      transition: box-shadow 0.2s, background 0.2s;
    }
    .section-box:focus-within,.section-box:hover {
      box-shadow: 0 8px 32px 0 rgba(99,102,241,0.10), 0 0.5px 2px 0 rgba(30,64,175,0.07);
      background: var(--section-bg-hover);
    }
    input[type='file']::file-selector-button {
      margin-right: 1rem; padding-top: .375rem; padding-bottom: .375rem;
      padding-left: 1rem; padding-right: 1rem;
      border-radius: 0.5rem; border: 0; font-size: .875rem;
      font-weight: 600; background-color: #eef2ff; color: #4338ca;
      transition: background 0.2s; cursor: pointer;
    }
    input[type='file']::file-selector-button:hover { background-color: #e0e7ff; }
    #nlpOutput, #categories {
      scrollbar-width: thin; scrollbar-color: #a5b4fc #f3f4f6;
    }
    #nlpOutput::-webkit-scrollbar,
    #categories::-webkit-scrollbar {
      height: 6px; width: 6px;
    }
    #nlpOutput::-webkit-scrollbar-thumb,
    #categories::-webkit-scrollbar-thumb {
      background: #a5b4fc; border-radius: 4px;
    }
    textarea:disabled { background-color: #e0e7ff; cursor: not-allowed; }
  </style>
</head>

<body class="bg-gradient-to-tr from-purple-100 via-indigo-200 to-blue-200 min-h-screen flex items-center justify-center font-inter antialiased">
  <div class="max-w-6xl w-full mx-auto py-8 px-4">
    <div class="backdrop-glass rounded-3xl shadow-2xl py-10 px-8 animate-fade-in">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-3">
        <div>
          <h1 class="text-4xl font-extrabold text-indigo-700 tracking-tight drop-shadow-lg">NeuraHub – The brain behind your queries.</h1>
          <h2 id="userGreeting" class="text-2xl font-bold text-indigo-900 mt-3"></h2>
        </div>
        <button id="logoutBtn" class="mt-4 sm:mt-0 px-5 py-2 bg-indigo-600 text-white rounded-xl shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-400 transition">
          Logout
        </button>
      </div>
      <div class="section-box mb-8 animate-slide-up">
        <h2 class="text-xl font-bold text-indigo-800 mb-2">Upload Your Document</h2>
        <input type="file" id="docUpload" accept=".txt,.pdf,.docx"
          class="block w-full border-2 border-indigo-200 rounded-lg p-2 shadow-sm transition focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" />
        <p id="fileError" class="mt-2 text-sm text-red-600 hidden"></p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
        <div class="section-box animate-fade-in delay-200">
          <h2 class="text-lg font-semibold text-indigo-700 mb-2">Preprocessing & NLP Output</h2>
          <div id="nlpOutput" class="min-h-[100px] text-base text-gray-800 transition-opacity duration-700"></div>
        </div>
        <div class="section-box animate-fade-in delay-300">
          <h2 class="text-lg font-semibold text-indigo-700 mb-2">Categorized Output</h2>
          <div id="categories" class="min-h-[100px] text-base text-gray-800"></div>
        </div>
      </div>
      <div class="section-box animate-fade-in delay-400 mb-8">
        <h2 class="text-lg font-semibold text-indigo-700 mb-2">User Query Input</h2>
        <div class="flex gap-4 items-start">
          <textarea id="userQuery"
            class="w-full p-3 border-2 border-indigo-200 rounded-lg shadow-sm resize-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-500 transition text-gray-900 bg-indigo-50 placeholder:text-indigo-400"
            rows="3" placeholder="Enter your query..." disabled></textarea>
          <button id="getSuggestionBtn"
            class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
            disabled>
            Get Suggestion
          </button>
        </div>
      </div>
      <!-- SUGGESTION section -->
      <div class="section-box animate-slide-up delay-700">
        <h2 class="text-xl font-bold text-indigo-800 mb-2">Suggestion</h2>
        <div id="suggestionOutput" class="min-h-[60px] text-indigo-900 text-base font-medium"></div>
      </div>
      
    </div>
  </div>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>

  <script>
    // Greet user by name
    document.addEventListener('DOMContentLoaded', () => {
      const userGreeting = document.getElementById('userGreeting');
      const username = localStorage.getItem('ai-username');
      userGreeting.textContent = username ? `Welcome, ${username}!` : "Welcome!";
    });

    // Logout
    const logoutBtn = document.getElementById('logoutBtn');
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('ai-loggedin');
      localStorage.removeItem('ai-username');
      window.location.href = 'index.html';
    });

    // UI Elements
    const docUpload = document.getElementById("docUpload");
    const nlpOutput = document.getElementById("nlpOutput");
    const categories = document.getElementById("categories");
    const userQuery = document.getElementById("userQuery");
    const suggestionOutput = document.getElementById("suggestionOutput");
    const getSuggestionBtn = document.getElementById("getSuggestionBtn");
    const fileError = document.getElementById("fileError");

    let docTextContent = "";

    // File reading utility
    async function readTextFromFile(file) {
      const fileName = file.name.toLowerCase();
      if (file.type.startsWith("text/") || fileName.endsWith(".txt")) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = e => resolve(e.target.result);
          reader.onerror = () => reject(new Error("Failed to read file."));
          reader.readAsText(file);
        });
      } else if (
        file.type === "application/pdf" || fileName.endsWith(".pdf")) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let text = "";
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          const strings = content.items.map(item => item.str);
          text += strings.join(" ") + " ";
        }
        return text;
      } else if (
        file.type === "application/vnd.openxmlformats-officedocument.wordprocessingml.document" || fileName.endsWith(".docx")
      ) {
        const arrayBuffer = await file.arrayBuffer();
        const result = await mammoth.extractRawText({ arrayBuffer });
        return result.value;
      } else {
        throw new Error("Unsupported file. Upload .txt, .pdf, or .docx");
      }
    }

    docUpload.addEventListener("change", async () => {
      nlpOutput.innerHTML = "";
      categories.innerHTML = "";
      suggestionOutput.innerHTML = "";
      fileError.classList.add('hidden');
      docTextContent = "";
      userQuery.value = "";
      userQuery.disabled = true;
      getSuggestionBtn.disabled = true;

      const file = docUpload.files[0];
      if (!file) return;

      try {
        nlpOutput.innerHTML = "<i>Processing your document...</i>";
        docTextContent = await readTextFromFile(file);
        nlpOutput.innerHTML = `<span class="inline-flex items-center px-2 py-1 rounded bg-indigo-100 text-indigo-700 font-semibold shadow-sm animate-fade-in">✅ NLP Processed:</span> <span class="ml-2 font-bold">${file.name}</span>`;

        // Top 5 keywords extraction
        const wordCounts = {};
        const words = docTextContent.toLowerCase().match(/\b\w+\b/g) || [];
        words.forEach(w => {
          if (w.length <= 3) return;
          wordCounts[w] = (wordCounts[w] || 0) + 1;
        });
        const topKeywords = Object.entries(wordCounts)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 5)
          .map(item => item[0]);

        categories.innerHTML = topKeywords.length
          ? `<div class="flex gap-2 flex-wrap">${topKeywords.map(k => `<span class="px-2 py-1 rounded-lg bg-blue-100 text-blue-800 font-semibold shadow">${k}</span>`).join('')}</div>`
          : `<span class="text-gray-600">No keywords extracted.</span>`;

        userQuery.disabled = false;
        getSuggestionBtn.disabled = false;
        userQuery.focus();
      } catch (err) {
        nlpOutput.innerHTML = `<span class="text-red-600">Failed to process: ${err.message}</span>`;
        fileError.textContent = err.message;
        fileError.classList.remove('hidden');
      }
    });

    // Enable the "Get Suggestion" button only if both doc and query are filled
    userQuery.addEventListener("input", () => {
      getSuggestionBtn.disabled = !(docTextContent && userQuery.value.trim());
      suggestionOutput.innerHTML = "";
    });

    // Suggestion Button Logic
    // Replace the whole getSuggestionBtn.addEventListener block:
getSuggestionBtn.addEventListener('click', async () => {
  const prompt = userQuery.value.trim();
  if (!prompt) {
    suggestionOutput.innerHTML = "<span class='text-red-600'>Please enter a query.</span>";
    return;
  }

  suggestionOutput.innerHTML = "<span class='text-indigo-500 animate-pulse'>Gemini is thinking...</span>";

  try {
const response = await fetch("https://yourproject.vercel.app/api/gemini", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
    body: JSON.stringify({
  docText: docTextContent.slice(0, 3000),
  userPrompt: prompt
}),

    });

    const data = await response.json();

    if (data && data.candidates && data.candidates.length > 0) {
      const text = data.candidates[0].content.parts[0].text;
      suggestionOutput.innerHTML = `<strong>Gemini Suggestion:</strong><br>${text}`;
    } else {
      suggestionOutput.innerHTML = "<span class='text-red-600'>No response from Gemini API.</span>";
    }

  } catch (error) {
    suggestionOutput.innerHTML = `<span class='text-red-600'>Error: ${error.message}</span>`;
  }
});


  </script>
  
</body>
</html>
